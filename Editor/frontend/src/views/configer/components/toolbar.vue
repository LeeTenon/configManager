<template>
  <div class="window-tool">
    <div>
      <el-popover placement="bottom" :width="1000" trigger="click" class="pop">
        <template #reference>
          <el-button plain style="border: none" @click="showLog">
            <svg
              t="1661093659881"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="6028"
              width="18"
              height="18"
            >
              <path
                d="M448.93 890.09H174.61a42.51 42.51 0 0 1-42.46-42.46V154.18a42.51 42.51 0 0 1 42.46-42.46h551.28a42.51 42.51 0 0 1 42.46 42.46v307.61H712V168.1H188.53v665.62h260.4z"
                p-id="6029"
              ></path>
              <path
                d="M253.01 241.57h410.51v56.38H253.01zM253.01 372.82h410.51v56.38H253.01zM706.86 915.29c-107.54 0-195-87.49-195-195s87.49-195 195-195 195 87.49 195 195-87.46 195-195 195z m0-333.69c-76.46 0-138.66 62.2-138.66 138.66s62.2 138.66 138.66 138.66 138.66-62.2 138.66-138.66S783.31 581.6 706.86 581.6z"
                p-id="6030"
              ></path>
              <path
                d="M785.26 742.45h-96.55V617.36h28.19v96.9h68.36v28.19z"
                p-id="6031"
              ></path>
            </svg>
          </el-button>
        </template>
        <codemirror
          v-model="log"
          placeholder="Welcome!"
          :style="coderStyle"
          :autofocus="false"
          :tabSize="2"
          :extensions="extensions"
        />
      </el-popover>
    </div>
    <el-button plain style="border: none; margin-left: 0" @click="minWindow">
      <svg
        t="1661079091636"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="2398"
        width="15"
        height="15"
      >
        <path
          d="M923 571H130.7c-27.6 0-50-22.4-50-50s22.4-50 50-50H923c27.6 0 50 22.4 50 50s-22.4 50-50 50z"
          fill=""
          p-id="2399"
        ></path>
      </svg>
    </el-button>
    <el-button plain style="border: none; margin-left: 0" @click="maxWindow">
      <svg
        v-if="!isMax"
        t="1661079538501"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="3275"
        width="13"
        height="13"
      >
        <path
          d="M173.344 896H352c17.673 0 32 14.327 32 32 0 17.673-14.327 32-32 32H96c-17.673 0-32-14.327-32-32V672c0-17.673 14.327-32 32-32 17.673 0 32 14.327 32 32v178.834l225.207-225.207c12.496-12.496 32.758-12.496 45.255 0 12.496 12.497 12.496 32.758 0 45.255L173.344 896z m677.49-768H672c-17.673 0-32-14.327-32-32 0-17.673 14.327-32 32-32h256c17.673 0 32 14.327 32 32v256c0 17.673-14.327 32-32 32-17.673 0-32-14.327-32-32V173.344L670.882 398.462c-12.497 12.496-32.758 12.496-45.255 0-12.496-12.497-12.496-32.759 0-45.255L850.834 128zM896 850.745V672c0-17.673 14.327-32 32-32 17.673 0 32 14.327 32 32v256c0 17.673-14.327 32-32 32H672c-17.673 0-32-14.327-32-32 0-17.673 14.327-32 32-32h178.745L625.627 670.882c-12.496-12.497-12.496-32.758 0-45.255 12.497-12.496 32.758-12.496 45.255 0L896 850.745z m-768-677.49V352c0 17.673-14.327 32-32 32-17.673 0-32-14.327-32-32V96c0-17.673 14.327-32 32-32h256c17.673 0 32 14.327 32 32 0 17.673-14.327 32-32 32H173.255l225.207 225.207c12.496 12.496 12.496 32.758 0 45.255-12.497 12.496-32.759 12.496-45.255 0L128 173.255z"
          p-id="3276"
        ></path>
      </svg>
      <svg
        v-else
        t="1661085785949"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="5091"
        width="15"
        height="15"
      >
        <path
          d="M923.378813 305.414945l-141.483338-0.514723L940.653245 147.093103c17.34504-17.545608 17.34504-45.962821 0-63.456241-17.450441-17.493419-45.684482-17.493419-63.045895 0L717.313597 243.092527 718.395232 98.782817c0.418532-18.11252-13.872962-33.870412-31.898501-33.44267l-22.806425 0c-18.008142 0.470721-32.927947 11.236925-33.29429 29.350468l-0.942465 250.378467c0 0.322341 1.169639 0.558725 1.169639 0.889253l-1.744737 16.420995c-0.140193 9.029654 1.989307 17.161868 7.818059 22.946618 5.740748 5.879917 13.837146 9.405207 22.806425 9.179057l16.280802-0.331551c0.366344 0 0.610914-0.140193 0.942465-0.192382l250.700809 1.413186c18.025539-0.418532 32.875758-15.381315 33.346479-33.529651l0-23.006993C958.050474 317.507354 941.35114 304.996412 923.378813 305.414945L923.378813 305.414945zM959.07992 687.11225l-0.052189-22.998807c-0.418532-18.148335-15.233959-33.102932-33.154098-33.538861l-249.393024 1.360997c-0.36532 0-0.610914-0.140193-0.942465-0.140193l-16.210193-0.36532c-8.951883-0.279363-16.996093 3.298116-22.720468 9.125845-5.792936 5.827729-7.90504 13.960966-7.730055 23.034623l1.744737 16.419971c0 0.331551-1.169639 0.576121-1.169639 0.890276l0.942465 248.449535c0.366344 18.11252 15.181771 28.879748 33.154098 29.315676l24.185842 0.034792c17.921161 0.435928 32.125675-15.373129 31.688723-33.486672l-1.029446-141.396357 159.64907 158.479431c17.257036 17.48421 45.3867 17.48421 62.696947 0 17.310248-17.502629 17.310248-45.910633 0-63.448054L781.284561 719.621665l140.540873-0.523933C939.711803 719.568453 956.357925 708.470697 959.07992 687.11225L959.07992 687.11225zM385.61094 640.590704c-5.740748-5.827729-13.837146-9.405207-22.807449-9.108448l-16.33299 0.366344c-0.278339 0-0.557702 0.140193-0.87288 0.140193l-247.367901-1.414209c-17.97335 0.436952-32.893154 15.390525-33.311687 33.538861l-0.052189 22.998807c2.721994 21.358447 19.438725 32.422434 37.412075 32.089859l139.494031 0.505513L81.722768 878.884948c-17.415648 17.554818-17.415648 45.962821 0 63.448054 17.379832 17.502629 45.560662 17.502629 62.958914 0l160.311149-159.403476-1.082658 140.540873c-0.435928 18.11252 13.872962 33.869389 31.846312 33.450856l22.859637 0c18.008142-0.471744 32.910551-11.203156 33.29429-29.351492l0.942465-246.670006c0-0.315178-1.169639-0.558725-1.169639-0.890276l1.780553-16.419971C393.549749 654.568043 391.456065 646.436852 385.61094 640.590704L385.61094 640.590704zM392.817062 345.070106l-0.941442-250.378467c-0.348947-18.113543-15.199167-28.92375-33.120328-29.394471l-24.184819 0c-17.903765-0.38374-32.107255 15.373129-31.688723 33.44267l1.081635 143.315056L144.367527 83.636862c-17.362436-17.493419-45.438888-17.493419-62.749136 0-17.310248 17.493419-17.310248 45.909609 0 63.456241l158.042479 157.807119-139.232065 0.514723c-17.86795-0.418532-34.480302 12.092409-37.202297 33.443693l0.034792 23.006993c0.435928 18.147312 15.251356 33.110095 33.172517 33.529651l249.374604-1.413186c0.348947 0.052189 0.576121 0.192382 0.907673 0.192382l16.228613 0.37453c8.933463 0.23536 17.030885-3.288906 22.719444-9.169847 5.792936-5.836939 7.887644-13.96813 7.712659-23.050995l-1.779529-16.410762C391.596258 345.584829 392.817062 345.392448 392.817062 345.070106L392.817062 345.070106zM392.817062 345.070106"
          p-id="5092"
        ></path>
      </svg>
    </el-button>
    <el-button plain style="border: none; margin-left: 0" @click="closeWindow">
      <svg
        t="1661079655693"
        class="icon"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="4179"
        width="15"
        height="15"
      >
        <path
          d="M843.741 237.342l-57.344-58.368-275.033 275.879L236.51 179.998l-57.344 58.368 274.432 274.432-274.432 275.456 57.344 58.368 275.032-275.88 274.856 274.856 57.344-58.368L569.31 512.798z"
          fill=""
          p-id="4180"
        ></path>
      </svg>
    </el-button>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from "vue";
import { Codemirror } from "vue-codemirror";
import { javascript } from "@codemirror/lang-javascript";
import { oneDark } from "@codemirror/theme-one-dark";
import { EditorView } from "@codemirror/view";

// 初始化
const win = window as any;
onMounted(() => {
  let pop = document.getElementsByClassName("el-popper is-light el-popover");
  let node = pop[0] as any;
  node.style.padding = "0";
  node.style.borderRadius = "7px";
  node.style.overflow = "hidden";
  // Log
  win.runtime.EventsOn("log-event", (e: string) => {
    if (log.value == "") {
      log.value = e;
    } else {
      log.value = log.value + "\n" + e;
    }
  });
});

// 窗口操作
const closeWindow = () => {
  win.runtime.Quit();
};
const minWindow = () => {
  // window.go.main.App.MinWindow()
  win.runtime.WindowMinimise();
};
const maxWindow = () => {
  if (isMax.value) {
    win.runtime.WindowUnmaximise();
    isMax.value = false;
  } else {
    win.runtime.WindowMaximise();
    isMax.value = true;
  }
};
const showLog = () => {
  isLog.value = true;
};
const isMax = ref(false);
const isLog = ref(false);

// 代码编辑器
const coderStyle = ref({
  maxHeight: "500px",
  background: "grey",
});
let myTheme = EditorView.theme(
  {
    // 输入的字体颜色
    "&": {
      color: "white",
      backgroundColor: "grey",
    },
    ".cm-content": {
      caretColor: "#0052D9",
    },
    // 激活背景色
    ".cm-activeLine": {
      backgroundColor: "grey",
    },
    // 激活序列的背景色
    ".cm-activeLineGutter": {
      backgroundColor: "grey",
    },
    //光标的颜色
    "&.cm-focused .cm-cursor": {
      borderLeftColor: "#0052D9",
    },
    // 选中的状态
    "&.cm-focused .cm-selectionBackground, ::selection": {
      backgroundColor: "#0052D9",
      color: "#FFFFFF",
    },
    // 左侧侧边栏的颜色
    ".cm-gutters": {
      backgroundColor: "grey",
      color: "white", //侧边栏文字颜色
      border: "none",
    },
  },
  { dark: true }
);
const extensions = [javascript(), oneDark];
const log = ref("");
</script>

<style scoped>
.window-tool {
  flex: 1;
  display: flex;
  justify-content: flex-end;
  margin-right: -15px;
  margin-top: -10px;
}
</style>
